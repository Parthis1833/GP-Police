<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logging Page</title>
    <link rel="stylesheet" href="css/singup.css">

</head>
<body>
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.9.2/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.9.2/firebase-analytics.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
  
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyDJBF8sUiD6n_yl5O8IIX3jSAMZ2UdCjcI",
      authDomain: "gp-police.firebaseapp.com",
      databaseURL: "https://gp-police-default-rtdb.asia-southeast1.firebasedatabase.app/",
      projectId: "gp-police",
      storageBucket: "gp-police.appspot.com",
      messagingSenderId: "399031635594",
      appId: "1:399031635594:web:b670b1a298056e12f76773",
      measurementId: "G-FGPZD71DER"
    };
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);

    import { getDatabase, ref, set, child, get, update, remove } 
           from"https://www.gstatic.com/firebasejs/9.9.2/firebase-database.js"
  
  const db = getDatabase();

//------------------------------------The refrences----------------------------------------//
    const username = document.getElementById('name');
    const pass     = document.getElementById('password');
    const email    = document.getElementById('email');
    const submit   = document.getElementById('submit');

//----------------------------------------Validation--------------------------------------//
  
function Validation(){
  let emailsin    = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;;
  let usernamesin = /\d+$/g;
  if(!emailsin.test(email.value)){
    alert("enter a valid email")
    return false;
  }
  if(!usernamesin.test(username.value)){
    alert("-username can only be alphanumeric")
    return false;
  }
  return true;
}
//------------------------------Register User To Firebase--------------------------------------//
  function SingingUser(){
   if(!Validation()){
      return;
   };
    const dbRef = ref(db);

    get(child(dbRef,"UsersList/"+username.value)).then((snapshot)=>{
      if(snapshot.exists()){
          alert("Accaunt Already Exist!");
      }

      else{
        set(ref(db, "UserList/"+username.value),{
          email: email.value,
          username:username.value,
          password:pass.value
        })
        .then(()=>{
          alert("user added successfully");
        })
        .catch((error)=>{
          alert("error"+error);
        })
      }
    });g
  }
  //-----------------------Assign The Events------------------------------------------//

    submit.addEventListener('click',SingingUser);
  </script>
    <div class="container">
        <div class="child">
          <h1>Signup</h1 >
          <form>
            <div class="row">
            <img src="image/logo.png" alt="GP_POLICE_LOGO" class="responsive">
            <h1 class="h1">Gujarat Police </h1>
          </div>
            <div class="row row1">
              <label for="name">User Name:</label>
              <input id="name" type="text" placeholder="User Name" class="fields" >
            </div>
            <div class="row">
              <label for="email">Email:</label>
              <input type="text" id="email" placeholder="name@gmail.com" class="fields" >
            </div>
            <div class="row">
              <label for="password">Password:</label>
              <input type="checkbox"
              id="show-password"
              class="show-password"
              checked
          >    
          <label for="show-password" class="Control-label Control-label--showPassword" >          
           <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="32" height="32" class="svg-toggle-password" title="Toggle Password Security">
            
             <path d="M24,9A23.654,23.654,0,0,0,2,24a23.633,23.633,0,0,0,44,0A23.643,23.643,0,0,0,24,9Zm0,25A10,10,0,1,1,34,24,10,10,0,0,1,24,34Zm0-16a6,6,0,1,0,6,6A6,6,0,0,0,24,18Z"/>
               <rect x="20.133" y="2.117" height="44" transform="translate(23.536 -8.587) rotate(45)" class="closed-eye"/>
               <rect x="22" y="3.984" width="4" height="44" transform="translate(25.403 -9.36) rotate(45)" style="fill:#fff" class="closed-eye"/>
           </svg>
          </label>
          <input type="text"
              id="password"
              placeholder=" "
              autocomplete="off"
              autocapitalize="off"
              autocorrect="off"
              required
              pattern=".{6,}"
              class="ControlInput ControlInput--password"
          >
            </div>
            <button id="submit"><a href="loging.html">Add account</a></button>
          </form>
        </div>
      </div>
</body>
</html>